<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<title>URL管理＆整理くん</title>

<style>
body {
  font-family: sans-serif;
  background: #fff;
  margin: 20px;
}
input, textarea, button {
  width: 100%;
  margin: 4px 0;
  padding: 6px;
}
.entry {
  border: 1px solid #ccc;
  padding: 10px;
  margin-top: 10px;
}
.small {
  font-size: 12px;
  color: #555;
}
</style>
</head>

<body>

<h1>URL管理＆整理くん</h1>

<button onclick="login()">Googleでログイン</button>
<button onclick="logout()">ログアウト</button>
<p id="user"></p>

<hr>

<h3>追加</h3>
<input id="url" placeholder="URL">
<input id="genre" placeholder="ジャンル">
<textarea id="memo" placeholder="メモ"></textarea>
<button onclick="addEntry()">追加</button>

<hr>

<div id="list"></div>

<!-- Firebase -->
<script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore-compat.js"></script>

<script>
/* ===== Firebase設定 ===== */
const firebaseConfig = {
  apiKey: "AIzaSyCRbxQK7LFzoEAeTYhFVrPEGCJx9QU7hAQ",
  authDomain: "url-kanri-kun.firebaseapp.com",
  projectId: "url-kanri-kun",
  storageBucket: "url-kanri-kun.appspot.com",
  messagingSenderId: "142130647668",
  appId: "1:142130647668:web:a24da9ae06dfa84ad37721"
};

firebase.initializeApp(firebaseConfig);

const auth = firebase.auth();
const db = firebase.firestore();

let currentUser = null;

/* ===== ログイン ===== */
function login() {
  const provider = new firebase.auth.GoogleAuthProvider();
  auth.signInWithPopup(provider);
}

/* ===== ログアウト ===== */
function logout() {
  auth.signOut();
}

/* ===== 認証状態監視 ===== */
auth.onAuthStateChanged(user => {
  if (user) {
    currentUser = user;
    document.getElementById("user").innerText =
      "ログイン中：" + user.displayName;
    loadEntries();
  } else {
    currentUser = null;
    document.getElementById("user").innerText = "未ログイン";
    document.getElementById("list").innerHTML = "";
  }
});

/* ===== 追加 ===== */
function addEntry() {
  if (!currentUser) return alert("ログインしてください");

  const url = document.getElementById("url").value;
  const genre = document.getElementById("genre").value;
  const memo = document.getElementById("memo").value;
  if (!url) return;

  db.collection("users")
    .doc(currentUser.uid)
    .collection("urls")
    .add({
      url,
      genre,
      memo,
      createdAt: firebase.firestore.FieldValue.serverTimestamp()
    });

  document.getElementById("url").value = "";
  document.getElementById("genre").value = "";
  document.getElementById("memo").value = "";
}

/* ===== 読み込み ===== */
function loadEntries() {
  db.collection("users")
    .doc(currentUser.uid)
    .collection("urls")
    .orderBy("createdAt", "desc")
    .onSnapshot(snapshot => {
      const list = document.getElementById("list");
      list.innerHTML = "";
      snapshot.forEach(doc => {
        const e = doc.data();
        list.innerHTML += `
          <div class="entry">
            <a href="${e.url}" target="_blank">${e.url}</a>
            <div>ジャンル：${e.genre || ""}</div>
            <div>メモ：${e.memo || ""}</div>
            <button onclick="removeEntry('${doc.id}')">削除</button>
          </div>
        `;
      });
    });
}

/* ===== 削除 ===== */
function removeEntry(id) {
  db.collection("users")
    .doc(currentUser.uid)
    .collection("urls")
    .doc(id)
    .delete();
}
</script>

</body>
</html>

